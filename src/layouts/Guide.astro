---
import { Image } from 'astro:assets';
import Layout from './Layout.astro';
const { title, seo_title, description, image, show_image, project } = Astro.props;
const content = { title, seo_title, description, image, show_image, project };

// Динамический импорт изображения из src/assets/images
let resolvedImage = null;

if (content.image) {
  try {
    // Убираем лишние префиксы из пути
    let cleanPath = content.image;
    
    // Варианты путей, которые может вернуть Decap CMS
    if (cleanPath.startsWith('src/assets/images/')) {
      cleanPath = cleanPath.replace('src/assets/images/', '');
    } else if (cleanPath.startsWith('/src/assets/images/')) {
      cleanPath = cleanPath.replace('/src/assets/images/', '');
    } else if (cleanPath.startsWith('images/')) {
      cleanPath = cleanPath.replace('images/', '');
    }
    
    // Динамический импорт
    const imageModule = await import(`../../assets/images/${cleanPath}`);
    resolvedImage = imageModule.default;
  } catch (error) {
    console.error('Error loading image:', error);
  }
}
---
<Layout title={content.seo_title || content.title} description={content.description} image={content.image} project={content.project}>
    <article>
        <div style="text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.75rem; font-weight: 700; color: var(--accent); margin-bottom: 1rem;">
            Step-by-Step Guide
        </div>
        <h1>{content.title}</h1>

{resolvedImage && content.show_image && (
          <Image 
            src={resolvedImage} 
            alt={content.seo_title || content.title}
            inferSize
            format="webp"
            quality={80}
            style="width: 100%; height: auto; border-radius: 12px; margin: 2rem 0; display: block;"
          />
        )}

        <section class="guide-content">
            <slot /> 
        </section>
    </article>
</Layout>
