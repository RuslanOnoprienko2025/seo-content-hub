---
import { getCollection } from 'astro:content';
import GuideLayout from '../layouts/Guide.astro';
import PostLayout from '../layouts/Post.astro';
import BaseLayout from '../layouts/Layout.astro';

const { slug } = Astro.params;
const allPosts = await getCollection('blog');
const entry = allPosts.find(post => post.slug === slug);

if (!entry) {
  return new Response('Not found', { status: 404 });
}

const { Content } = await entry.render();

// Определяем layout на основе frontmatter
let Layout;
if (entry.data.layout?.includes('Guide')) {
  Layout = GuideLayout;
} else if (entry.data.layout?.includes('Post')) {
  Layout = PostLayout;
} else {
  Layout = BaseLayout;
}
---

<Layout {...entry.data}>
  <Content />
</Layout>

<style is:global>
  /* Если заголовок всё еще дублируется, этот стиль скроет тот, 
     который выводится автоматически внутри Layout, 
     оставив только заголовок из шаблона статьи */
  
  /* .your-layout-h1-class { display: none; } */
</style>
