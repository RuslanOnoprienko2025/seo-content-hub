---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

// 1. –ü–æ–ª—É—á–∞–µ–º –¥–æ–º–µ–Ω
const forwardedHost = Astro.request.headers.get('x-forwarded-host');
const hostHeader = Astro.request.headers.get('host');
const cfIp = Astro.request.headers.get('cf-connecting-ip');

let rawHostname;
if (cfIp) {
    rawHostname = forwardedHost || hostHeader;
} else {
    rawHostname = Astro.url.hostname;
}

const hostname = rawHostname ? rawHostname.split(':')[0].trim() : '';

// 2. –ö–æ–Ω—Ñ–∏–≥–∏ (–≤—Å–µ 7)
const seoConfigs = {
  "blog.fastimageconvert.onl": {
    title: "JPG to WebP Conversion Guide - Optimization Tips",
    description: "Learn how to convert JPG to WebP for better performance.",
    canonical: "https://blog.fastimageconvert.onl/",
    project: "jpg-to-webp"
  },
  "blog.fastimageconvert.online": {
    title: "WebP Optimization Guide - PNG Compression Tips",
    description: "Master WebP format for modern websites.",
    canonical: "https://blog.fastimageconvert.online/",
    project: "png-to-webp"
  },
  "blog.fastimageconvert.xyz": {
    title: "WebP to PNG Guide - Compatibility & Design Tips",
    description: "Convert WebP to PNG while preserving quality.",
    canonical: "https://blog.fastimageconvert.xyz/",
    project: "webp-to-png"
  },
  "blog.fastimageconvert.pro": {
    title: "WebP to JPG Conversion Guide - Compatibility Tips",
    description: "Learn how to convert WebP to JPG for universal compatibility.",
    canonical: "https://blog.fastimageconvert.pro/",
    project: "webp-to-jpg"
  },
  "blog.fastimageconvert.pics": {
    title: "PNG to JPG Guide - Compression & Quality Tips",
    description: "Learn how to compress PNG to JPG efficiently.",
    canonical: "https://blog.fastimageconvert.pics/",
    project: "png-to-jpg"
  },
  "blog.fastimageconvert.help": {
    title: "PNG Transparency Guide - JPG Conversion Tips",
    description: "Learn how to add transparency to images by converting JPG to PNG.",
    canonical: "https://blog.fastimageconvert.help/",
    project: "jpg-to-png"
  },
  "blog.emailsignatures.xyz": {
    title: "Email Signature Best Practices - Business Tips",
    description: "Learn email signature best practices for business.",
    canonical: "https://blog.emailsignatures.xyz/",
    project: "signatures"
  }
};

// 3. –ü—Ä—è–º–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
let currentConfig = seoConfigs[hostname];

if (!currentConfig) {
  currentConfig = {
    title: "DEBUG MODE - Config Not Found",
    description: "Debug",
    canonical: "https://test.com",
    project: "jpg-to-png"
  };
}

const allPosts = await getCollection('blog');
const sortedPosts = allPosts.filter(p => p.data.project === currentConfig.project);
---

<Layout title={currentConfig.title} description={currentConfig.description} canonical={currentConfig.canonical} project={currentConfig.project} image="">
  <div style="background: yellow; padding: 20px; margin: 20px; border: 2px solid red;">
    <h3>üîç DEBUG INFO:</h3>
    <p><strong>hostname:</strong> "{hostname}"</p>
    <p><strong>forwardedHost:</strong> {forwardedHost || "null"}</p>
    <p><strong>hostHeader:</strong> {hostHeader || "null"}</p>
    <p><strong>cfIp:</strong> {cfIp || "null"}</p>
    <p><strong>rawHostname:</strong> "{rawHostname}"</p>
    <p><strong>Config found:</strong> {seoConfigs[hostname] ? "‚úÖ YES" : "‚ùå NO"}</p>
  </div>
  
  <h1>{currentConfig.title}</h1>
  <p>Posts found: {sortedPosts.length}</p>
  
  {sortedPosts.length > 0 ? (
    sortedPosts.slice(0, 3).map(post => (
      <article style="margin-bottom: 20px;">
        <h2>{post.data.title}</h2>
      </article>
    ))
  ) : (
    <p>No articles found</p>
  )}
</Layout>
