---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

// 1. Определяем, на каком поддомене находится пользователь
const hostname = Astro.url.hostname;

// 2. Карта соответствия: какой поддомен какой проект показывает
const projectMap = {
  'blog.fastimageconvert.onl': 'webp',
  'blog.emailsignatures.xyz': 'signatures',
  // Сюда добавите остальные 5 поддоменов в будущем
};

// 3. Определяем текущий проект (если домен не в списке, берем 'webp')
const currentProject = projectMap[hostname] || 'webp';

// 4. Получаем все статьи и фильтруем их по проекту
const allPosts = await getCollection('blog');
const filteredPosts = allPosts.filter(post => post.data.project === currentProject);

// 5. Сортируем по дате
const sortedPosts = filteredPosts.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<Layout title="Expert Blog" description="Knowledge base">
  <header style="margin-bottom: 40px; border-bottom: 1px solid #eee; padding-bottom: 20px;">
    <h1>{currentProject === 'webp' ? 'Image Optimization' : 'Email Etiquette'}</h1>
  </header>

  <section>
    {sortedPosts.length > 0 ? (
      sortedPosts.map(post => (
        <article style="margin-bottom: 30px;">
          <h2 style="font-size: 1.8rem; margin-bottom: 10px;">
            <a href={`/blog/${post.slug}`} style="color: #1a1a1a; text-decoration: none;">
              {post.data.title}
            </a>
          </h2>
          <p style="color: #666;">{post.data.description}</p>
          <a href={`/blog/${post.slug}`} style="color: #0070f3; font-weight: bold; text-decoration: none;">
            Read article →
          </a>
        </article>
      ))
    ) : (
      <p>Статей для этого проекта пока нет.</p>
    )}
  </section>
</Layout>
